<!DOCTYPE html>
<html>
  <head>
    <title>Political Shift In Elections Between 2000 & 2018</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link href="main.css" type="text/css" rel="stylesheet" />
    <script src="bundle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Lato&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet" />
  </head>
  <body>
    <div class="content">
      <div class="title">
        <div class="title-main">
          Political Shift In Elections Between 2000 & 2018
        </div>
        <div class="title-main-sub">
          Firat Ciftci · Joe Berusch · David Yaffe
        </div>
      </div>

      <div class="vis-text">
        Since the beginning of the millennium, the world has been rapidly changing. From technology to
        politics, every realm of the human life has been shifting and readjusting itself to a more globalized
        and connected world. With these changes, the political views and ideologies of people have been
        getting affected as well. For the last few years, the media has been continuously focusing on one
        major phenomenon: the rise of right-wing politics. Although this topic has been getting a lot of
        coverage, we were curious regarding the validity of such claim. Thus, we decided to analyze election
        data from the start of the millennium in order to decisively see how the political alignment of people
        has shifted. In our research and analysis, we focused on a few broad regions: North America, Europe,
        and the Middle East. This webpage includes several visualizations that display some of our core
        findings, with more information about such ideas above each visualization.
      </div>

      <hr />

      <!-- Bar (Firat) -->
      <div class="vis-group">
        <div class="vis-text">
          We begin with looking at the world in geopolitical sections. The exact specifications of each region
          that we have used can be found
          <a
            href="https://commons.wikimedia.org/wiki/File:Regions_of_Europe_based_on_CIA_world_factbook.png"
            target="_blank"
            style="font-weight: 1000"
          >
            here</a
          >. The bar chart below displays the mean political alignment in each region between 2000-2018. On
          the y-axis, positive (+) translates to right-wing aligment, and negative (-) means left-wing
          aligment. Hovering over each bar plot gives more information regarding the exact numeral alignment
          for specific regions. Furthermore, the regional buttons at the top of the visualization leads to
          sub-visualizations for the countries in each region; for example, clicking on 'Western Europe' will
          give more detailed information on the political alignment of all Western European countries.
        </div>
        <div class="vis-text" style="margin-top: 1rem">
          This visualization can lead to one clear conclusion: Independent of election-specific changes, the
          countries that we have analyzed have been more right-wing during the 21st century. There are eight
          regions that are more right-wing, and only three that are more left-wing. The visualizations below
          will give us more information regarding exact political shifts for each region.
        </div>
        <div id="barChart1Vis" class="vis">
          <div class="vis-title">Mean Political Alignment by Region</div>
          <div class="vis-buttons">
            <button id="reset" style="background-color: #333" onclick="regionClick(this.id)">Reset</button>
            <button
              id="Eastern Europe"
              style="background-color: rgb(166,206,227)"
              onclick="regionClick(this.id)"
            >
              Eastern Europe
            </button>
            <button
              id="Western Europe"
              style="background-color: rgb(31,120,180)"
              onclick="regionClick(this.id)"
            >
              Western Europe
            </button>
            <button
              id="Southwestern Europe"
              style="background-color: rgb(178,223,138)"
              onclick="regionClick(this.id)"
            >
              Southwestern Europe
            </button>
            <button
              id="Northern Europe"
              style="background-color: rgb(51,160,44)"
              onclick="regionClick(this.id)"
            >
              Northern Europe
            </button>
            <button
              id="Central Europe"
              style="background-color: rgb(251,154,153)"
              onclick="regionClick(this.id)"
            >
              Central Europe
            </button>
            <button
              id="Southern Europe"
              style="background-color: rgb(227,26,28)"
              onclick="regionClick(this.id)"
            >
              Southern Europe
            </button>
            <button
              id="Southeastern Europe"
              style="background-color: rgb(253,191,111)"
              onclick="regionClick(this.id)"
            >
              Southeastern Europe
            </button>
            <button id="Central Asia" style="background-color: rgb(255,127,0)" onclick="regionClick(this.id)">
              Central Asia
            </button>
            <button
              id="Southwestern Asia"
              style="background-color: rgb(202,178,214)"
              onclick="regionClick(this.id)"
            >
              Southwestern Asia
            </button>
            <button
              id="North America"
              style="background-color: rgb(106,61,154)"
              onclick="regionClick(this.id)"
            >
              North America
            </button>
            <button
              id="Middle East"
              style="background-color: rgb(177, 89, 40)"
              onclick="regionClick(this.id)"
            >
              Middle East
            </button>
          </div>
          <canvas id="RegionsBarChart"></canvas>
        </div>
      </div>
      <script>
        const SECRETKEY = '$2a$10$95O3pYS8s40pMgpxV.LKI.n5pC9JTNFa3MODMZzfDG2JAZ3mhrIFe';

        function mean(arr) {
          return arr.reduce((p, c, _, a) => p + c / a.length, 0);
        }

        function groupBy(data, key) {
          return data.reduce((acc, row) => {
            if (!acc[row[key]]) {
              acc[row[key]] = [];
            }
            acc[row[key]].push(row);
            return acc;
          }, {});
        }

        function regionClick(region) {
          getElectionsData(region);
        }

        function getElectionsData(region) {
          let countryData = null;
          let req = new XMLHttpRequest();
          req.open('GET', 'https://api.jsonbin.io/b/5d01889058196b429f531883', true);
          req.setRequestHeader('secret-key', SECRETKEY);
          req.onload = function() {
            var jsonResponse = req.response;
            countryData = JSON.parse(jsonResponse);
            const regions = [...new Set(countryData.map(d => d.Region))];
            const regionData = [];

            regions.forEach(region => {
              const specificRegion = {};
              const regionDataFirstMean = mean(
                countryData
                  .filter(d => d.Region === region && d.ElectionYear <= 2005)
                  .map(d => d.WeightedElectionScore)
              );
              const regionDataLastMean = mean(
                countryData
                  .filter(d => d.Region === region && d.ElectionYear > 2005)
                  .map(d => d.WeightedElectionScore)
              );
              specificRegion['Region'] = region;
              specificRegion['MeanScore'] = mean([regionDataFirstMean, regionDataLastMean]);
              regionData.push(specificRegion);
            });

            var chart = document.getElementById('RegionsBarChart');
            const regionDataR = groupBy(regionData, 'Region');
            const regionDataM = groupBy(regionData, 'MeanScore');

            const regionsBarChart = new Chart(chart, {
              type: 'bar',
              data: {
                labels: Object.keys(regionDataR),
                datasets: [
                  {
                    label: 'Mean Political Leaning of Region',
                    data: Object.keys(regionDataM).map(x => parseFloat(x).toFixed(2)),
                    backgroundColor: [
                      'rgba(166, 206, 227, 0.5)',
                      'rgba(31, 120, 180, 0.5)',
                      'rgba(178, 223, 138, 0.5)',
                      'rgba(51, 160, 44, 0.5)',
                      'rgba(251, 154, 153, 0.5)',
                      'rgba(227, 26, 28, 0.5)',
                      'rgba(253, 191, 111, 0.5)',
                      'rgba(255, 127, 0, 0.5)',
                      'rgba(202, 178, 214, 0.5)',
                      'rgba(106, 61, 154, 0.5)',
                      'rgba(177, 89, 40, 0.5)'
                    ],
                    borderColor: [
                      'rgba(166, 206, 227, 1)',
                      'rgba(31, 120, 180, 1)',
                      'rgba(178, 223, 138, 1)',
                      'rgba(51, 160, 44, 1)',
                      'rgba(251, 154, 153, 1)',
                      'rgba(227, 26, 28, 1)',
                      'rgba(253, 191, 111, 1)',
                      'rgba(255, 127, 0, 1)',
                      'rgba(202, 178, 214, 1)',
                      'rgba(106, 61, 154, 1)',
                      'rgba(177, 89, 40, 1)'
                    ],
                    borderWidth: 1
                  }
                ]
              },
              options: {
                scales: {
                  yAxes: [
                    {
                      ticks: {
                        beginAtZero: true
                      },
                      scaleLabel: {
                        display: true,
                        labelString: 'Weighted Probability Score'
                      }
                    }
                  ],
                  xAxes: [
                    {
                      scaleLabel: {
                        display: true,
                        labelString: 'Regions'
                      }
                    }
                  ]
                },
                legend: {
                  display: false
                }
              }
            });

            if (region !== undefined && region !== 'reset') {
              const countriesInRegion = countryData.filter(d => d.Region === region && d.ElectionYear > 2005);

              const countryDataC = groupBy(countriesInRegion, 'Country');
              const countryDataM = groupBy(countriesInRegion, 'WeightedCountryScore');

              $('#RegionsBarChart').remove();
              $('#barChart1Vis').append('<canvas id="RegionsBarChart"><canvas>');

              chart = document.getElementById('RegionsBarChart');
              const countriesBarChart = new Chart(chart, {
                type: 'bar',
                data: {
                  labels: Object.keys(countryDataC),
                  datasets: [
                    {
                      label: 'Mean Political Leaning of Country',
                      data: Object.keys(countryDataM).map(x => parseFloat(x).toFixed(2)),
                      backgroundColor: [
                        'rgba(166, 206, 227, 0.5)',
                        'rgba(31, 120, 180, 0.5)',
                        'rgba(178, 223, 138, 0.5)',
                        'rgba(51, 160, 44, 0.5)',
                        'rgba(251, 154, 153, 0.5)',
                        'rgba(227, 26, 28, 0.5)',
                        'rgba(253, 191, 111, 0.5)',
                        'rgba(255, 127, 0, 0.5)',
                        'rgba(202, 178, 214, 0.5)',
                        'rgba(106, 61, 154, 0.5)',
                        'rgba(177, 89, 40, 0.5)'
                      ],
                      borderColor: [
                        'rgba(166, 206, 227, 1)',
                        'rgba(31, 120, 180, 1)',
                        'rgba(178, 223, 138, 1)',
                        'rgba(51, 160, 44, 1)',
                        'rgba(251, 154, 153, 1)',
                        'rgba(227, 26, 28, 1)',
                        'rgba(253, 191, 111, 1)',
                        'rgba(255, 127, 0, 1)',
                        'rgba(202, 178, 214, 1)',
                        'rgba(106, 61, 154, 1)',
                        'rgba(177, 89, 40, 1)'
                      ],
                      borderWidth: 1
                    }
                  ]
                },
                options: {
                  scales: {
                    yAxes: [
                      {
                        ticks: {
                          beginAtZero: true
                        },
                        scaleLabel: {
                          display: true,
                          labelString: 'Weighted Probability Score'
                        }
                      }
                    ],
                    xAxes: [
                      {
                        scaleLabel: {
                          display: true,
                          labelString: 'Countries in ' + region
                        }
                      }
                    ]
                  },
                  legend: {
                    display: false
                  }
                }
              });
            } else if (region === 'reset') {
              $('#RegionsBarChart').remove();
              $('#barChart1Vis').append('<canvas id="RegionsBarChart"><canvas>');

              var chart = document.getElementById('RegionsBarChart');
              const regionDataR = groupBy(regionData, 'Region');
              const regionDataM = groupBy(regionData, 'MeanScore');

              const regionsBarChart = new Chart(chart, {
                type: 'bar',
                data: {
                  labels: Object.keys(regionDataR),
                  datasets: [
                    {
                      label: 'Mean Political Leaning',
                      data: Object.keys(regionDataM).map(x => parseFloat(x).toFixed(2)),
                      backgroundColor: [
                        'rgba(166, 206, 227, 0.5)',
                        'rgba(31, 120, 180, 0.5)',
                        'rgba(178, 223, 138, 0.5)',
                        'rgba(51, 160, 44, 0.5)',
                        'rgba(251, 154, 153, 0.5)',
                        'rgba(227, 26, 28, 0.5)',
                        'rgba(253, 191, 111, 0.5)',
                        'rgba(255, 127, 0, 0.5)',
                        'rgba(202, 178, 214, 0.5)',
                        'rgba(106, 61, 154, 0.5)',
                        'rgba(177, 89, 40, 0.5)'
                      ],
                      borderColor: [
                        'rgba(166, 206, 227, 1)',
                        'rgba(31, 120, 180, 1)',
                        'rgba(178, 223, 138, 1)',
                        'rgba(51, 160, 44, 1)',
                        'rgba(251, 154, 153, 1)',
                        'rgba(227, 26, 28, 1)',
                        'rgba(253, 191, 111, 1)',
                        'rgba(255, 127, 0, 1)',
                        'rgba(202, 178, 214, 1)',
                        'rgba(106, 61, 154, 1)',
                        'rgba(177, 89, 40, 1)'
                      ],
                      borderWidth: 1
                    }
                  ]
                },
                options: {
                  scales: {
                    yAxes: [
                      {
                        ticks: {
                          beginAtZero: true
                        },
                        scaleLabel: {
                          display: true,
                          labelString: 'Weighted Probability Score'
                        }
                      }
                    ],
                    xAxes: [
                      {
                        scaleLabel: {
                          display: true,
                          labelString: 'Countries in Region'
                        }
                      }
                    ]
                  },
                  legend: {
                    display: false
                  }
                }
              });
            }
          };
          req.send();

          return countryData;
        }

        const countryData = getElectionsData();
      </script>

      <hr />

      <!-- Scatter (Joe) -->
      <div class="vis-group">
        <div class="vis-text">
          The visualization below gives us a better idea of how each region has shifted in terms of their
          political alignment. Each point in the scatter plot gives exact information about each region's
          overall political alignment in their first and last elections. The toggle above the visualization
          enables us to switch between the first and last election data; as the layout stays the same between
          the scatterplot of the first and last election data, we can see how a region has changed in terms of
          their alignment. The visualization below this one gives us a larger picture into overall shift of
          regions and countries.
        </div>
        <div id="scatterVis" class="vis">
          <div class="vis-title">Political Alignment of Regions in 2000 and 2018</div>
          <div class="vis-switch">
            <div style="background-color: white; align-self: center">First Election (~2000)</div>
            <label class="switch">
              <input type="checkbox" id="first-last-switch" onclick="drawScatter1()" />
              <span class="slider round"></span>
            </label>
            <div style="background-color: white; align-self: center">Last Election (~2018)</div>
          </div>
          <canvas id="MapAllRegions"></canvas>
        </div>
      </div>
      <script>
        const drawScatter1 = () => {
          // determine whether user has selected first or last election
          const selectedFirst = !document.getElementById('first-last-switch').checked;

          let countryData = null;

          let req = new XMLHttpRequest();
          req.open('GET', 'https://api.jsonbin.io/b/5d01889058196b429f531883', true);
          req.setRequestHeader('secret-key', SECRETKEY);
          req.onload = function() {
            var jsonResponse = req.response;
            countryData = JSON.parse(jsonResponse);
            const regions = [...new Set(countryData.map(d => d.Region))];
            const regionData = [];

            regions.forEach(region => {
              const specificRegion = {};

              const regionDataFirstMean = mean(
                countryData
                  .filter(d => d.Region === region && d.ElectionYear <= 2005)
                  .map(d => d.WeightedElectionScore)
              );

              const regionDataLastMean = mean(
                countryData
                  .filter(d => d.Region === region && d.ElectionYear > 2005)
                  .map(d => d.WeightedElectionScore)
              );
              specificRegion['Region'] = region;
              specificRegion['FirstScore'] = regionDataFirstMean;
              specificRegion['SecondScore'] = regionDataLastMean;
              regionData.push(specificRegion);
            });

            const regionDataR = groupBy(regionData, 'Region');
            const regionDataV1 = groupBy(regionData, 'FirstScore');
            const regionDataV2 = groupBy(regionData, 'SecondScore');

            // draw chart
            if (selectedFirst === true) {
              $('#MapAllRegions').remove();
              $('#scatterVis').append('<canvas id="MapAllRegions"><canvas>');

              const chartNode = document.getElementById('MapAllRegions');
              const scatterPlot = new Chart(chartNode, {
                type: 'scatter',
                data: {
                  datasets: [
                    {
                      label: 'Political Leaning First Election',
                      data: Object.values(regionDataR).map(x => x[0].FirstScore.toFixed(2)),
                      backgroundColor: 'rgba(255, 100, 100, 1)',
                      radius: 7,
                      hoverRadius: 10
                    }
                  ],
                  labels: Object.keys(regionDataR)
                },
                options: {
                  scales: {
                    xAxes: [
                      {
                        type: 'category',
                        position: 'bottom',
                        ticks: {
                          min: 'Eastern Europe',
                          max: 'Middle East'
                        }
                      }
                    ]
                  },
                  legend: {
                    onClick: e => e.stopPropagation()
                  },
                  animation: false
                }
              });
            }

            if (selectedFirst === false) {
              $('#MapAllRegions').remove();
              $('#scatterVis').append('<canvas id="MapAllRegions"><canvas>');

              const chartNode = document.getElementById('MapAllRegions');

              const scatterPlot = new Chart(chartNode, {
                type: 'scatter',
                data: {
                  datasets: [
                    {
                      label: 'Political Leaning Last Election',
                      data: Object.values(regionDataR).map(x => x[0].SecondScore.toFixed(2)),
                      backgroundColor: 'rgba(100, 100, 255, 1)',
                      radius: 7,
                      hoverRadius: 10
                    }
                  ],
                  labels: Object.keys(regionDataR)
                },
                options: {
                  scales: {
                    xAxes: [
                      {
                        type: 'category',
                        position: 'bottom',
                        ticks: {
                          min: 'Eastern Europe',
                          max: 'Middle East'
                        }
                      }
                    ]
                  },
                  legend: {
                    onClick: e => e.stopPropagation()
                  },
                  animation: false
                }
              });
            }
          };

          req.send();
        };

        drawScatter1();
      </script>

      <hr />

      <!-- Horizontal Bar (David) -->
      <div class="vis-group">
        <div class="vis-text">
          This horizontal bar chart sheds light onto a critical question we had from the beginning: Has there
          been an increase in right-wing politics since the beginning of the millennium? From the
          visualization, we can state that it would be really difficult to come to a conclusion a strong shift
          toward right-wing politics. Although more countries have shifted right (24) than left (20), the
          numbers are really close to each other; furthermore, when grouped by region through the checkbox on
          top of the visualization, we see that an equal amount of regions for both left-wing and right-wing
          shift (5).
        </div>
        <div class="vis-text" style="margin-top: 1rem">
          However, one thing could be concluded: The world has been shifting more to the extremes, rather than
          staying in the center and abiding to the status quo. Out of 54 countries that we have analyzed, only
          10 have stayed the same throughout the 18-year period. All others have seen political polarization;
          yet, we cannot make any value-judgments regarding this matter. A centrist would possibly find this
          data worrying, while a more left- or right-leaning person could find this a step in the right
          direction; it is all a matter of perspective.
        </div>
        <div id="horizontalVis" class="vis">
          <div class="vis-title">How many countries/regions have politically shifted?</div>
          <div class="vis-switch">
            <div style="background-color: white; align-self: center">Group By Region:</div>
            <div class="round">
              <input type="checkbox" id="checkbox" onclick="drawPieChart1()" />
              <label for="checkbox"></label>
            </div>
          </div>
          <canvas id="HorizontalBarChart"></canvas>
        </div>
      </div>
      <script>
        const drawPieChart1 = () => {
          function groupBy(data, key) {
            return data.reduce((acc, row) => {
              if (!acc[row[key]]) {
                acc[row[key]] = [];
              }
              acc[row[key]].push(row);
              return acc;
            }, {});
          }

          // determine whether user has checked the box
          const useDefault = !document.getElementById('checkbox').checked;

          let req = new XMLHttpRequest();
          let countryData = null;

          req.open('GET', 'https://api.jsonbin.io/b/5d01889058196b429f531883', true);
          req.setRequestHeader('secret-key', SECRETKEY);
          req.onload = function() {
            var jsonResponse = req.response;
            countryData = JSON.parse(jsonResponse);
            const regions = [...new Set(countryData.map(d => d.Region))];
            const regionData = [];

            regions.forEach(region => {
              const specificRegion = {};

              const regionDataFirstMean = mean(
                countryData
                  .filter(d => d.Region === region && d.ElectionYear <= 2005)
                  .map(d => d.WeightedElectionScore)
              );

              const regionDataLastMean = mean(
                countryData
                  .filter(d => d.Region === region && d.ElectionYear > 2005)
                  .map(d => d.WeightedElectionScore)
              );

              specificRegion['Region'] = region;
              specificRegion['FirstScore'] = regionDataFirstMean;
              specificRegion['SecondScore'] = regionDataLastMean;

              const absRegionScore = Math.abs(regionDataLastMean - regionDataFirstMean);
              if (absRegionScore < 3) {
                specificRegion['Moved'] = 1;
              } else if (regionDataLastMean > regionDataFirstMean) {
                specificRegion['Moved'] = 2;
              } else {
                specificRegion['Moved'] = 0;
              }
              regionData.push(specificRegion);
            });

            const countryLabels = ['Shifted Left', 'Stayed Roughly the Same', 'Shifted Right'];

            const groupedCountryData = groupBy(countryData, 'Country');
            const groupedCountryDataCountries = Object.keys(groupedCountryData);

            const countryShifts = groupedCountryDataCountries.reduce((total, countryName) => {
              countryData = groupedCountryData[countryName];
              const absScore = Math.abs(
                countryData[1].WeightedElectionScore - countryData[0].WeightedElectionScore
              );
              if (absScore < 3) {
                if (total[countryLabels[1]]) {
                  total[countryLabels[1]] += 1;
                } else {
                  total[countryLabels[1]] = 1;
                }
              } else if (countryData[1].WeightedElectionScore > countryData[0].WeightedElectionScore) {
                if (total[countryLabels[2]]) {
                  total[countryLabels[2]] += 1;
                } else {
                  total[countryLabels[2]] = 1;
                }
              } else {
                if (total[countryLabels[0]]) {
                  total[countryLabels[0]] += 1;
                } else {
                  total[countryLabels[0]] = 1;
                }
              }
              return total;
            }, {});

            const regionDataR = groupBy(regionData, 'Region');
            const regionDataV1 = groupBy(regionData, 'FirstScore');
            const regionDataV2 = groupBy(regionData, 'SecondScore');
            const regionDataMoved = groupBy(regionData, 'Moved');

            const regionShifts = { 'Shifted Left': 0, 'Stayed Roughly the Same': 0, 'Shifted Right': 0 };

            const regionShiftsbleh = regionData.reduce((total, countryData) => {
              const labelIndex = countryData['Moved'];
              regionShifts[countryLabels[labelIndex]] += 1;
              return total;
            }, {});

            // draw chart
            if (useDefault === true) {
              $('#HorizontalBarChart').remove();
              $('#horizontalVis').append('<canvas id="HorizontalBarChart"><canvas>');

              const chartNode = document.getElementById('HorizontalBarChart');
              var regionsBarChart = new Chart(chartNode, {
                type: 'horizontalBar',
                data: {
                  labels: useDefault ? Object.keys(countryShifts) : Object.keys(regionShifts),
                  datasets: [
                    {
                      label: 'Number of Countries',
                      data: Object.values(countryShifts),
                      backgroundColor: ['#e6194b', '#3cb44b', '#ffe119'],
                      borderWidth: 1
                    }
                  ]
                },
                options: {
                  scales: {
                    xAxes: [
                      {
                        ticks: {
                          beginAtZero: true,
                          callback: function(value) {
                            if (value % 1 === 0) {
                              return value;
                            }
                          }
                        },
                        scaleLabel: {
                          display: true,
                          labelString: 'Number of Countries'
                        }
                      }
                    ],
                    yAxes: [
                      {
                        scaleLabel: {
                          display: false,
                          labelString: ''
                        }
                      }
                    ]
                  },
                  legend: {
                    display: false
                  }
                }
              });
            }

            if (useDefault === false) {
              $('#HorizontalBarChart').remove();
              $('#horizontalVis').append('<canvas id="HorizontalBarChart"><canvas>');

              const chartNode = document.getElementById('HorizontalBarChart');
              var regionsBarChart = new Chart(chartNode, {
                type: 'horizontalBar',
                data: {
                  labels: useDefault ? Object.keys(countryShifts) : Object.keys(regionShifts),
                  datasets: [
                    {
                      label: 'Number of Regions',
                      data: Object.values(regionShifts),
                      backgroundColor: ['#e6194b', '#3cb44b', '#ffe119'],
                      borderWidth: 1
                    }
                  ]
                },
                options: {
                  scales: {
                    xAxes: [
                      {
                        ticks: {
                          beginAtZero: true,
                          callback: function(value) {
                            if (value % 1 === 0) {
                              return value;
                            }
                          }
                        },
                        scaleLabel: {
                          display: true,
                          labelString: 'Number of Regions'
                        }
                      }
                    ],
                    yAxes: [
                      {
                        scaleLabel: {
                          display: false,
                          labelString: ''
                        }
                      }
                    ]
                  },
                  legend: {
                    display: false
                  }
                }
              });
            }
          };

          req.send();
        };

        drawPieChart1();
      </script>

      <hr />

      <div class="vis-group">
        <div class="vis-text">
          It is time to focus more on specific countries. Amongst all the countries we have analyzed, we can
          conclude that Ukraine is the one that has shifted right-wing the most. The visualization below gives
          more information regarding the first and last elections of the 21<sup>st</sup> century for Ukraine.
          The labels on top of the visualization are interactive; if clicked, they hide/show specific
          elections, so that you can focus more on one election if needed. Moreover, hovering over each bar
          plot gives more information regarding the percentage of votes gained by each political alignment. If
          you are curious regarding what has been happening in Ukraine, including the reasons for such extreme
          political shift,
          <a
            href="https://en.wikipedia.org/wiki/Politics_of_Ukraine#Political_parties_and_elections"
            target="_blank"
            style="font-weight: 1000"
            >you can check out the Wikipedia page for Ukrainian politics</a
          >.
        </div>
        <div id="countryVis1" class="vis">
          <div class="vis-title">Ukraine: The country that shifted the most toward the right</div>
          <canvas id="countryVisCanvas1"></canvas>
        </div>
      </div>
      <script>
        function mean(arr) {
          return arr.reduce((p, c, _, a) => p + c / a.length, 0);
        }

        function groupBy(data, key) {
          return data.reduce((acc, row) => {
            if (!acc[row[key]]) {
              acc[row[key]] = [];
            }
            acc[row[key]].push(row);
            return acc;
          }, {});
        }

        function drawBarChart1(region) {
          let countryData = null;
          let req = new XMLHttpRequest();
          req.open('GET', 'https://api.jsonbin.io/b/5d01889058196b429f531883', true);
          req.setRequestHeader('secret-key', SECRETKEY);
          req.onload = function() {
            var jsonResponse = req.response;
            countryData = JSON.parse(jsonResponse);
            const regions = [...new Set(countryData.map(d => d.Region))];
            const regionData = [];

            regions.forEach(region => {
              const specificRegion = {};
              const regionDataFirstMean = mean(
                countryData
                  .filter(d => d.Region === region && d.ElectionYear <= 2005)
                  .map(d => d.WeightedElectionScore)
              );
              const regionDataLastMean = mean(
                countryData
                  .filter(d => d.Region === region && d.ElectionYear > 2005)
                  .map(d => d.WeightedElectionScore)
              );
              specificRegion['Region'] = region;
              specificRegion['MeanScore'] = mean([regionDataFirstMean, regionDataLastMean]);
              regionData.push(specificRegion);
            });

            var chartNode = document.getElementById('countryVisCanvas1');

            countryData.sort((a, b) => b.WeightedElectionScore - a.WeightedElectionScore);
            rightmostLastElection = countryData[0];
            rightmostFirstElection = countryData.find(
              x =>
                x.Country === rightmostLastElection.Country &&
                x.ElectionYear !== rightmostLastElection.ElectionYear
            );

            // get votes by denomination (center, center right, etc.)
            const votingDataFirst = {
              Left: 29.7,
              'Center Left': 0,
              Center: 5.9,
              'Center Right': 0,
              Right: 55.7
            };
            const votingDataLast = {
              Left: 11.8,
              'Center Left': 0,
              Center: 0,
              'Center Right': 0,
              Right: 84.4
            };
            console.log(Object.values(votingDataLast));

            const barChart = new Chart(chartNode, {
              type: 'bar',
              data: {
                labels: ['Left', 'Center Left', 'Center', 'Center Right', 'Right'],
                datasets: [
                  {
                    data: Object.values(votingDataFirst),
                    label: '2000 Election',
                    backgroundColor: 'green'
                  },
                  {
                    data: Object.values(votingDataLast),
                    label: '2018 Election',
                    backgroundColor: 'purple'
                  }
                ]
              },
              options: {
                scales: {
                  xAxes: [
                    {
                      scaleLabel: {
                        display: true,
                        labelString: 'Party Affiliation'
                      }
                    }
                  ],
                  yAxes: [
                    {
                      scaleLabel: {
                        display: true,
                        labelString: 'Percentage Votes Received'
                      }
                    }
                  ]
                }
              }
            });
          };
          req.send();

          return countryData;
        }

        drawBarChart1();
      </script>

      <hr />

      <div class="vis-group">
        <div class="vis-text">
          Continuing along with our political analysis for specific countries, from the data we have gathered,
          we can conclude that Mexico is the country that has encountered a left-wing shift the most. Similar
          to the visualization above, the one below gives us information regarding the first and last
          elections we have gathered. For more information about Mexican politics, you can check out
          <a href="https://en.wikipedia.org/wiki/Politics_of_Mexico" target="_blank" style="font-weight: 1000"
            >the relevant Wikipedia page</a
          >.
        </div>
        <div id="leftMostCountry" class="vis">
          <div class="vis-title">Mexico: The country that shifted the most toward the left</div>
          <canvas id="leftMostCountryVis"></canvas>
        </div>
      </div>
      <script>
        function mean(arr) {
          return arr.reduce((p, c, _, a) => p + c / a.length, 0);
        }

        function groupBy(data, key) {
          return data.reduce((acc, row) => {
            if (!acc[row[key]]) {
              acc[row[key]] = [];
            }
            acc[row[key]].push(row);
            return acc;
          }, {});
        }

        function drawBarChart2(region) {
          let countryData = null;
          let req = new XMLHttpRequest();
          req.open('GET', 'https://api.jsonbin.io/b/5d01889058196b429f531883', true);
          req.setRequestHeader('secret-key', SECRETKEY);
          req.onload = function() {
            var jsonResponse = req.response;
            countryData = JSON.parse(jsonResponse);
            const regions = [...new Set(countryData.map(d => d.Region))];
            const regionData = [];

            regions.forEach(region => {
              const specificRegion = {};
              const regionDataFirstMean = mean(
                countryData
                  .filter(d => d.Region === region && d.ElectionYear <= 2005)
                  .map(d => d.WeightedElectionScore)
              );
              const regionDataLastMean = mean(
                countryData
                  .filter(d => d.Region === region && d.ElectionYear > 2005)
                  .map(d => d.WeightedElectionScore)
              );
              specificRegion['Region'] = region;
              specificRegion['MeanScore'] = mean([regionDataFirstMean, regionDataLastMean]);
              regionData.push(specificRegion);
            });

            var chartNode = document.getElementById('leftMostCountryVis');

            countryData.sort((a, b) => a.WeightedElectionScore - b.WeightedElectionScore);
            leftMostLastElection = countryData[0];
            leftMostFirstElection = countryData.find(
              x =>
                x.Country === leftMostLastElection.Country &&
                x.ElectionYear !== leftMostLastElection.ElectionYear
            );

            console.log(leftMostLastElection, leftMostFirstElection);

            // get votes by denomination (center, center right, etc.)
            const votingDataLast = {
              Left: 50.5,
              'Center Left': 11.7,
              Center: 0,
              'Center Right': 27.7,
              Right: 0
            };
            const votingDataFirst = {
              Left: 53.8,
              'Center Left': 0,
              Center: 0,
              'Center Right': 46.2,
              Right: 0
            };

            const barChart = new Chart(chartNode, {
              type: 'bar',
              data: {
                labels: ['Left', 'Center Left', 'Center', 'Center Right', 'Right'],
                datasets: [
                  {
                    data: Object.values(votingDataFirst),
                    label: '2001 Election',
                    backgroundColor: 'green'
                  },
                  {
                    data: Object.values(votingDataLast),
                    label: '2015 Election',
                    backgroundColor: 'purple'
                  }
                ]
              },
              options: {
                scales: {
                  xAxes: [
                    {
                      scaleLabel: {
                        display: true,
                        labelString: 'Party Affiliation'
                      }
                    }
                  ],
                  yAxes: [
                    {
                      scaleLabel: {
                        display: true,
                        labelString: 'Percentage Votes Received'
                      }
                    }
                  ]
                }
              }
            });
          };
          req.send();

          return countryData;
        }

        drawBarChart2();
      </script>

      <hr />

      <div class="vis-text">
        Source:
        <a href="http://psephos.adam-carr.net/" target="_blank" style="font-weight: 1000; padding-bottom: 2rem"
          >Adam Carr's Election Archive</a
        >
      </div>
    </div>
  </body>
</html>
